"use strict";var _promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var isNODE="undefined"==typeof window,createCanvas=void 0,loadImage=void 0;function imageScaler(e){var r=e.imageUrl,d=e.width,m=e.height,n=e.quality,g=void 0===n?1:n,t=e.mimeType,f=void 0===t?"jpeg":t;return new _promise2.default(function(c,l){d||m?(isNODE?["jpeg","png"]:["jpeg","png","webp"]).includes(f)?loadImage(r).then(function(e){!function(e){var r=isNODE?createCanvas():document.createElement("canvas"),n=r.getContext("2d"),t=e.width,i=e.height,a=d?d/t:m/i,o=d||Math.round(t*a),u=m||Math.round(i*a);if(r.width=o,r.height=u,n.drawImage(e,0,0,o,u),isNODE){var s={};"jpeg"===f?s.quality=g:s.compressionLevel=g,r.toBuffer(function(e,r){e?l(e):c(r)},"image/"+f,s)}else r.toBlob(function(e){var r=window.URL.createObjectURL(e);c({blob:e,url:r})},"image/"+f,g)}(e)}):l(new Error("MimeType wrong ! ")):l(new Error("Width and height at least one ! "))})}function isLocalImage(e){if(e.includes("http")){if(e.includes("localhost")||e.includes("192.168.1.10"))return!0;var r=/http(s)?:\/\/(.*?)\//;return window.location.href.match(r)[0]===e.match(r)[0]}return!0}loadImage=isNODE?(createCanvas=require("canvas").createCanvas,require("canvas").loadImage):function(t){return new _promise2.default(function(e,r){var n=new Image;n.setAttribute("crossOrigin","Anonymous"),isLocalImage(t)?n.src=t:n.src="https://images.weserv.nl/?url="+t,n.complete?e(n):(n.onload=function(){e(n)},n.onerror=function(){r(new Error("load image error"))})})},module.exports=imageScaler;