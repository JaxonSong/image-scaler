"use strict";var _promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var isNODE="undefined"==typeof window,createCanvas=void 0,loadImage=void 0;function imageScaler(e){var r=e.imageUrl,n=e.scaleTo,m=void 0===n?100:n,i=e.quality,d=void 0===i?1:i,a=e.mimeType,g=void 0===a?"jpeg":a;return new _promise2.default(function(c,l){(isNODE?["jpeg","png"]:["jpeg","png","webp"]).includes(g)?loadImage(r).then(function(e){!function(e){var r=isNODE?createCanvas():document.createElement("canvas"),n=r.getContext("2d"),i=e.width,a=e.height,t=m/i,o=Math.round(i*t),u=Math.round(a*t);if(r.width=o,r.height=u,n.drawImage(e,0,0,o,u),isNODE){var s={};"jpeg"===g?s.quality=d:s.compressionLevel=d,r.toBuffer(function(e,r){e?l(e):c(r)},"image/"+g,s)}else r.toBlob(function(e){var r=window.URL.createObjectURL(e);c({blob:e,url:r})},"image/"+g,d)}(e)}):l(new Error("mimeType wrong ! "))})}function isLocalImage(e){if(e.includes("http")){if(e.includes("localhost")||e.includes("192.168.1.10"))return!0;var r=/http(s)?:\/\/(.*?)\//;return window.location.href.match(r)[0]===e.match(r)[0]}return!0}loadImage=isNODE?(createCanvas=require("canvas").createCanvas,require("canvas").loadImage):function(i){return new _promise2.default(function(e,r){var n=new Image;n.setAttribute("crossOrigin","Anonymous"),isLocalImage(i)?n.src=i:n.src="https://images.weserv.nl/?url="+i,n.complete?e(n):(n.onload=function(){e(n)},n.onerror=function(){r(new Error("load image error"))})})},module.exports=imageScaler;